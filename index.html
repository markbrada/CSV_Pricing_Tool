<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bathroom Renovation Checklist</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- html2pdf.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-blue-600 text-white p-4 text-center">
    <h1 class="text-2xl font-bold">Bathroom Renovation Checklist</h1>
  </header>

  <main class="max-w-7xl mx-auto p-4">
    <!-- Export Buttons -->
    <div class="flex flex-wrap gap-4 justify-end mb-6">
      <button id="exportCSV" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded shadow">
        Export CSV
      </button>
      <button id="exportPDF" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded shadow">
        Export PDF
      </button>
    </div>

    <!-- Sections Container -->
    <div id="checklistContainer">
      <!-- DEMOLITION SECTION -->
      <section class="bg-white shadow rounded mb-6 p-4" data-section="Demolition">
        <h2 class="text-xl font-semibold mb-4 border-b pb-2">Demolition</h2>
        <table class="min-w-full divide-y divide-gray-200 mb-4">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-2 py-1 text-left">Task Description</th>
              <th class="px-2 py-1 text-left">Calc Type</th>
              <th class="px-2 py-1 text-left">Quantity</th>
              <th class="px-2 py-1 text-left">Hours</th>
              <th class="px-2 py-1 text-left">Rate ($)</th>
              <th class="px-2 py-1 text-left">Material Cost ($)</th>
              <th class="px-2 py-1 text-left">Total ($)</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100" id="demolitionBody">
            <!-- Sample Row -->
            <tr class="task-row">
              <td class="px-2 py-1">
                <input type="text" class="w-full border rounded p-1" value="Remove floor tiles" />
              </td>
              <td class="px-2 py-1">
                <select class="calc-type border rounded p-1">
                  <option value="quantity" selected>Quantity</option>
                  <option value="hours">Hours</option>
                </select>
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="quantity w-full border rounded p-1" value="5" />
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="hours w-full border rounded p-1" value="" />
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="rate w-full border rounded p-1" value="20" />
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="material-cost w-full border rounded p-1" value="50" />
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="total-cost w-full border rounded p-1 bg-gray-100" readonly />
              </td>
            </tr>
          </tbody>
        </table>
        <!-- Section Total -->
        <div class="flex justify-end font-semibold">
          Section Total: $<span class="section-total">0</span>
        </div>
      </section>

      <!-- PLUMBING SECTION -->
      <section class="bg-white shadow rounded mb-6 p-4" data-section="Plumbing">
        <h2 class="text-xl font-semibold mb-4 border-b pb-2">Plumbing</h2>
        <table class="min-w-full divide-y divide-gray-200 mb-4">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-2 py-1 text-left">Task Description</th>
              <th class="px-2 py-1 text-left">Calc Type</th>
              <th class="px-2 py-1 text-left">Quantity</th>
              <th class="px-2 py-1 text-left">Hours</th>
              <th class="px-2 py-1 text-left">Rate ($)</th>
              <th class="px-2 py-1 text-left">Material Cost ($)</th>
              <th class="px-2 py-1 text-left">Total ($)</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100" id="plumbingBody">
            <!-- Sample Row -->
            <tr class="task-row">
              <td class="px-2 py-1">
                <input type="text" class="w-full border rounded p-1" value="Install new sink" />
              </td>
              <td class="px-2 py-1">
                <select class="calc-type border rounded p-1">
                  <option value="quantity">Quantity</option>
                  <option value="hours" selected>Hours</option>
                </select>
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="quantity w-full border rounded p-1" value="" />
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="hours w-full border rounded p-1" value="2" />
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="rate w-full border rounded p-1" value="100" />
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="material-cost w-full border rounded p-1" value="30" />
              </td>
              <td class="px-2 py-1">
                <input type="number" step="any" class="total-cost w-full border rounded p-1 bg-gray-100" readonly />
              </td>
            </tr>
          </tbody>
        </table>
        <!-- Section Total -->
        <div class="flex justify-end font-semibold">
          Section Total: $<span class="section-total">0</span>
        </div>
      </section>

      <!-- Grand Total -->
      <div class="flex justify-end font-bold text-xl border-t pt-4">
        Grand Total: $<span id="grandTotal">0</span>
      </div>
    </div>
  </main>

  <script>
    // Function to calculate row total based on selected calculation method
    function calculateRow(row) {
      const calcType = row.querySelector(".calc-type").value;
      const quantity = parseFloat(row.querySelector(".quantity").value) || 0;
      const hours = parseFloat(row.querySelector(".hours").value) || 0;
      const rate = parseFloat(row.querySelector(".rate").value) || 0;
      const materialCost = parseFloat(row.querySelector(".material-cost").value) || 0;
      let laborCost = 0;

      if (calcType === "hours") {
        laborCost = hours * rate;
      } else {
        laborCost = quantity * rate;
      }
      return laborCost + materialCost;
    }

    // Function to update totals for a given section element
    function updateSectionTotals(section) {
      const rows = section.querySelectorAll(".task-row");
      let sectionTotal = 0;
      rows.forEach((row) => {
        const total = calculateRow(row);
        row.querySelector(".total-cost").value = total.toFixed(2);
        sectionTotal += total;
      });
      section.querySelector(".section-total").textContent = sectionTotal.toFixed(2);
      return sectionTotal;
    }

    // Update all totals (per section and grand total)
    function updateTotals() {
      const sections = document.querySelectorAll("section[data-section]");
      let grandTotal = 0;
      sections.forEach((section) => {
        grandTotal += updateSectionTotals(section);
      });
      document.getElementById("grandTotal").textContent = grandTotal.toFixed(2);
    }

    // Attach event listeners to input fields for live calculations
    function attachListeners() {
      const inputs = document.querySelectorAll("input, select");
      inputs.forEach((input) => {
        input.addEventListener("input", updateTotals);
        input.addEventListener("change", updateTotals);
      });
    }

    // CSV Export functionality
    function exportCSV() {
      let csvContent = "data:text/csv;charset=utf-8,";
      csvContent += "Section,Task Description,Calc Type,Quantity,Hours,Rate,Material Cost,Total\n";
      const sections = document.querySelectorAll("section[data-section]");
      sections.forEach((section) => {
        const sectionName = section.getAttribute("data-section");
        const rows = section.querySelectorAll(".task-row");
        rows.forEach((row) => {
          const desc = row.querySelector("input[type='text']").value;
          const calcType = row.querySelector(".calc-type").value;
          const quantity = row.querySelector(".quantity").value;
          const hours = row.querySelector(".hours").value;
          const rate = row.querySelector(".rate").value;
          const materialCost = row.querySelector(".material-cost").value;
          const total = row.querySelector(".total-cost").value;
          csvContent += `${sectionName},"${desc}",${calcType},${quantity},${hours},${rate},${materialCost},${total}\n`;
        });
      });
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "bathroom_reno_checklist.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // PDF Export functionality using html2pdf.js
    function exportPDF() {
      const element = document.getElementById("checklistContainer");
      const opt = {
        margin:       0.5,
        filename:     'bathroom_reno_checklist.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }

    // Attach event listeners to export buttons
    document.getElementById("exportCSV").addEventListener("click", exportCSV);
    document.getElementById("exportPDF").addEventListener("click", exportPDF);

    // Initialize calculations on page load
    attachListeners();
    updateTotals();
  </script>
</body>
</html>
